var swfobject=function(){function t(){if(!H){try{var t=j.getElementsByTagName("body")[0].appendChild(y("span"));t.parentNode.removeChild(t)}catch(e){return}H=!0;for(var a=z.length,r=0;a>r;r++)z[r]()}}function e(t){H?t():z[z.length]=t}function a(t){if(typeof M.addEventListener!=E)M.addEventListener("load",t,!1);else if(typeof j.addEventListener!=E)j.addEventListener("load",t,!1);else if(typeof M.attachEvent!=E)m(M,"onload",t);else if("function"==typeof M.onload){var e=M.onload;M.onload=function(){e(),t()}}else M.onload=t}function r(){O?i():n()}function i(){var t=j.getElementsByTagName("body")[0],e=y(A);e.setAttribute("type",F);var a=t.appendChild(e);if(a){var r=0;!function(){if(typeof a.GetVariable!=E){var i=a.GetVariable("$version");i&&(i=i.split(" ")[1].split(","),q.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)])}else if(10>r)return r++,void setTimeout(arguments.callee,10);t.removeChild(e),a=null,n()}()}else n()}function n(){var t=P.length;if(t>0)for(var e=0;t>e;e++){var a=P[e].id,r=P[e].callbackFn,i={success:!1,id:a};if(q.pv[0]>0){var n=v(a);if(n)if(!k(P[e].swfVersion)||q.wk&&q.wk<312)if(P[e].expressInstall&&o()){var d={};d.data=P[e].expressInstall,d.width=n.getAttribute("width")||"0",d.height=n.getAttribute("height")||"0",n.getAttribute("class")&&(d.styleclass=n.getAttribute("class")),n.getAttribute("align")&&(d.align=n.getAttribute("align"));for(var p={},h=n.getElementsByTagName("param"),u=h.length,f=0;u>f;f++)"movie"!=h[f].getAttribute("name").toLowerCase()&&(p[h[f].getAttribute("name")]=h[f].getAttribute("value"));c(d,p,a,r)}else l(n),r&&r(i);else w(a,!0),r&&(i.success=!0,i.ref=s(a),r(i))}else if(w(a,!0),r){var y=s(a);y&&typeof y.SetVariable!=E&&(i.success=!0,i.ref=y),r(i)}}}function s(t){var e=null,a=v(t);if(a&&"OBJECT"==a.nodeName)if(typeof a.SetVariable!=E)e=a;else{var r=a.getElementsByTagName(A)[0];r&&(e=r)}return e}function o(){return!R&&k("6.0.65")&&(q.win||q.mac)&&!(q.wk&&q.wk<312)}function c(t,e,a,r){R=!0,T=r||null,C={success:!1,id:a};var i=v(a);if(i){"OBJECT"==i.nodeName?(_=d(i),$=null):(_=i,$=a),t.id=V,(typeof t.width==E||!/%$/.test(t.width)&&parseInt(t.width,10)<310)&&(t.width="310"),(typeof t.height==E||!/%$/.test(t.height)&&parseInt(t.height,10)<137)&&(t.height="137"),j.title=j.title.slice(0,47)+" - Flash Player Installation";var n=q.ie&&q.win?"ActiveX":"PlugIn",s="MMredirectURL="+M.location.toString().replace(/&/g,"%26")+"&MMplayerType="+n+"&MMdoctitle="+j.title;if(typeof e.flashvars!=E?e.flashvars+="&"+s:e.flashvars=s,q.ie&&q.win&&4!=i.readyState){var o=y("div");a+="SWFObjectNew",o.setAttribute("id",a),i.parentNode.insertBefore(o,i),i.style.display="none",function(){4==i.readyState?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)}()}p(t,e,a)}}function l(t){if(q.ie&&q.win&&4!=t.readyState){var e=y("div");t.parentNode.insertBefore(e,t),e.parentNode.replaceChild(d(t),e),t.style.display="none",function(){4==t.readyState?t.parentNode.removeChild(t):setTimeout(arguments.callee,10)}()}else t.parentNode.replaceChild(d(t),t)}function d(t){var e=y("div");if(q.win&&q.ie)e.innerHTML=t.innerHTML;else{var a=t.getElementsByTagName(A)[0];if(a){var r=a.childNodes;if(r)for(var i=r.length,n=0;i>n;n++)1==r[n].nodeType&&"PARAM"==r[n].nodeName||8==r[n].nodeType||e.appendChild(r[n].cloneNode(!0))}}return e}function p(t,e,a){var r,i=v(a);if(q.wk&&q.wk<312)return r;if(i)if(typeof t.id==E&&(t.id=a),q.ie&&q.win){var n="";for(var s in t)t[s]!=Object.prototype[s]&&("data"==s.toLowerCase()?e.movie=t[s]:"styleclass"==s.toLowerCase()?n+=' class="'+t[s]+'"':"classid"!=s.toLowerCase()&&(n+=" "+s+'="'+t[s]+'"'));var o="";for(var c in e)e[c]!=Object.prototype[c]&&(o+='<param name="'+c+'" value="'+e[c]+'" />');i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+n+">"+o+"</object>",U[U.length]=t.id,r=v(t.id)}else{var l=y(A);l.setAttribute("type",F);for(var d in t)t[d]!=Object.prototype[d]&&("styleclass"==d.toLowerCase()?l.setAttribute("class",t[d]):"classid"!=d.toLowerCase()&&l.setAttribute(d,t[d]));for(var p in e)e[p]!=Object.prototype[p]&&"movie"!=p.toLowerCase()&&h(l,p,e[p]);i.parentNode.replaceChild(l,i),r=l}return r}function h(t,e,a){var r=y("param");r.setAttribute("name",e),r.setAttribute("value",a),t.appendChild(r)}function u(t){var e=v(t);e&&"OBJECT"==e.nodeName&&(q.ie&&q.win?(e.style.display="none",function(){4==e.readyState?f(t):setTimeout(arguments.callee,10)}()):e.parentNode.removeChild(e))}function f(t){var e=v(t);if(e){for(var a in e)"function"==typeof e[a]&&(e[a]=null);e.parentNode.removeChild(e)}}function v(t){var e=null;try{e=j.getElementById(t)}catch(a){}return e}function y(t){return j.createElement(t)}function m(t,e,a){t.attachEvent(e,a),D[D.length]=[t,e,a]}function k(t){var e=q.pv,a=t.split(".");return a[0]=parseInt(a[0],10),a[1]=parseInt(a[1],10)||0,a[2]=parseInt(a[2],10)||0,e[0]>a[0]||e[0]==a[0]&&e[1]>a[1]||e[0]==a[0]&&e[1]==a[1]&&e[2]>=a[2]?!0:!1}function g(t,e,a,r){if(!q.ie||!q.mac){var i=j.getElementsByTagName("head")[0];if(i){var n=a&&"string"==typeof a?a:"screen";if(r&&(x=null,S=null),!x||S!=n){var s=y("style");s.setAttribute("type","text/css"),s.setAttribute("media",n),x=i.appendChild(s),q.ie&&q.win&&typeof j.styleSheets!=E&&j.styleSheets.length>0&&(x=j.styleSheets[j.styleSheets.length-1]),S=n}q.ie&&q.win?x&&typeof x.addRule==A&&x.addRule(t,e):x&&typeof j.createTextNode!=E&&x.appendChild(j.createTextNode(t+" {"+e+"}"))}}}function w(t,e){if(G){var a=e?"visible":"hidden";H&&v(t)?v(t).style.visibility=a:g("#"+t,"visibility:"+a)}}function b(t){var e=/[\\\"<>\.;]/,a=null!=e.exec(t);return a&&typeof encodeURIComponent!=E?encodeURIComponent(t):t}{var _,$,T,C,x,S,E="undefined",A="object",I="Shockwave Flash",L="ShockwaveFlash.ShockwaveFlash",F="application/x-shockwave-flash",V="SWFObjectExprInst",N="onreadystatechange",M=window,j=document,B=navigator,O=!1,z=[r],P=[],U=[],D=[],H=!1,R=!1,G=!0,q=function(){var t=typeof j.getElementById!=E&&typeof j.getElementsByTagName!=E&&typeof j.createElement!=E,e=B.userAgent.toLowerCase(),a=B.platform.toLowerCase(),r=/win/.test(a?a:e),i=/mac/.test(a?a:e),n=/webkit/.test(e)?parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,s=!1,o=[0,0,0],c=null;if(typeof B.plugins!=E&&typeof B.plugins[I]==A)c=B.plugins[I].description,!c||typeof B.mimeTypes!=E&&B.mimeTypes[F]&&!B.mimeTypes[F].enabledPlugin||(O=!0,s=!1,c=c.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),o[0]=parseInt(c.replace(/^(.*)\..*$/,"$1"),10),o[1]=parseInt(c.replace(/^.*\.(.*)\s.*$/,"$1"),10),o[2]=/[a-zA-Z]/.test(c)?parseInt(c.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof M.ActiveXObject!=E)try{var l=new ActiveXObject(L);l&&(c=l.GetVariable("$version"),c&&(s=!0,c=c.split(" ")[1].split(","),o=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]))}catch(d){}return{w3:t,pv:o,wk:n,ie:s,win:r,mac:i}}();!function(){q.w3&&((typeof j.readyState!=E&&"complete"==j.readyState||typeof j.readyState==E&&(j.getElementsByTagName("body")[0]||j.body))&&t(),H||(typeof j.addEventListener!=E&&j.addEventListener("DOMContentLoaded",t,!1),q.ie&&q.win&&(j.attachEvent(N,function(){"complete"==j.readyState&&(j.detachEvent(N,arguments.callee),t())}),M==top&&!function(){if(!H){try{j.documentElement.doScroll("left")}catch(e){return void setTimeout(arguments.callee,0)}t()}}()),q.wk&&!function(){return H?void 0:/loaded|complete/.test(j.readyState)?void t():void setTimeout(arguments.callee,0)}(),a(t)))}(),function(){q.ie&&q.win&&window.attachEvent("onunload",function(){for(var t=D.length,e=0;t>e;e++)D[e][0].detachEvent(D[e][1],D[e][2]);for(var a=U.length,r=0;a>r;r++)u(U[r]);for(var i in q)q[i]=null;q=null;for(var n in swfobject)swfobject[n]=null;swfobject=null})}()}return{registerObject:function(t,e,a,r){if(q.w3&&t&&e){var i={};i.id=t,i.swfVersion=e,i.expressInstall=a,i.callbackFn=r,P[P.length]=i,w(t,!1)}else r&&r({success:!1,id:t})},getObjectById:function(t){return q.w3?s(t):void 0},embedSWF:function(t,a,r,i,n,s,l,d,h,u){var f={success:!1,id:a};q.w3&&!(q.wk&&q.wk<312)&&t&&a&&r&&i&&n?(w(a,!1),e(function(){r+="",i+="";var e={};if(h&&typeof h===A)for(var v in h)e[v]=h[v];e.data=t,e.width=r,e.height=i;var y={};if(d&&typeof d===A)for(var m in d)y[m]=d[m];if(l&&typeof l===A)for(var g in l)typeof y.flashvars!=E?y.flashvars+="&"+g+"="+l[g]:y.flashvars=g+"="+l[g];if(k(n)){var b=p(e,y,a);e.id==a&&w(a,!0),f.success=!0,f.ref=b}else{if(s&&o())return e.data=s,void c(e,y,a,u);w(a,!0)}u&&u(f)})):u&&u(f)},switchOffAutoHideShow:function(){G=!1},ua:q,getFlashPlayerVersion:function(){return{major:q.pv[0],minor:q.pv[1],release:q.pv[2]}},hasFlashPlayerVersion:k,createSWF:function(t,e,a){return q.w3?p(t,e,a):void 0},showExpressInstall:function(t,e,a,r){q.w3&&o()&&c(t,e,a,r)},removeSWF:function(t){q.w3&&u(t)},createCSS:function(t,e,a,r){q.w3&&g(t,e,a,r)},addDomLoadEvent:e,addLoadEvent:a,getQueryParamValue:function(t){var e=j.location.search||j.location.hash;if(e){if(/\?/.test(e)&&(e=e.split("?")[1]),null==t)return b(e);for(var a=e.split("&"),r=0;r<a.length;r++)if(a[r].substring(0,a[r].indexOf("="))==t)return b(a[r].substring(a[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(R){var t=v(V);t&&_&&(t.parentNode.replaceChild(_,t),$&&(w($,!0),q.ie&&q.win&&(_.style.display="block")),T&&T(C)),R=!1}}}}(),apiswf=null,playback_token="GA1VQtLg_____2R2cHlzNHd5ZXg3Z2M0OXdoaDY3aHdrbnd3dy5wcmRpby5jb229Lci-G1YF9zVvTMWC3UWj",domain="www.prdio.com",track_pos=-1;$(document).ready(function(){Array.prototype.allValuesSame=function(){for(var t=1;t<this.length;t++)if(this[t]!==this[0])return!1;return!0};var t={playbackToken:playback_token,domain:domain,listener:"Playlist.Controller.prototype"},e={allowScriptAccess:"always"},a={};swfobject.embedSWF("http://www.rdio.com/api/swf/","apiswf",1,1,"9.0.0","expressInstall.swf",t,e,a),$(".play").click(function(){apiswf.rdio_play($("#play_key").val())}),$(".resume").click(function(){apiswf.rdio_play()}),$(".stop").click(function(){apiswf.rdio_stop()}),$(".pause").click(function(){apiswf.rdio_pause()}),$(".previous").click(function(){apiswf.rdio_previous()}),$(".next").on("click",function(){$(".next").attr("class","modular next busy"),trackVotes=[],$("#tracks .track").each(function(t){trackVotes.push(parseInt($("#tracks .track:eq("+t+") .vote").html()))}),allSame=trackVotes.allValuesSame(),allSame?(console.log("ALLSAME TRIGGER"),apiswf.rdio_next()):apiswf.rdio_play($("#play_key").val()),$("#highest_key").val($("#tracks .track:eq(1)").data("key"))})});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};jQuery(function(){return!/party/i.test(window.location.href)||/search/i.test(window.location.href)||/new/i.test(window.location.href)?void 0:window.trackController=new Playlist.Controller($("#switcher").data("uri"),!0)}),window.Playlist={},Playlist.User=function(){function t(t,e){this.user_name=t,this.host_id=e,this.serialize=__bind(this.serialize,this)}return t.prototype.serialize=function(){return{user_name:this.user_name,host_id:this.host_id}},t}(),Playlist.Controller=function(){function t(t,e){this.createGuestUser=__bind(this.createGuestUser,this),this.shiftTrackQueue=__bind(this.shiftTrackQueue,this),this.updateUserList=__bind(this.updateUserList,this),this.likeTrack=__bind(this.likeTrack,this),this.dislikeTrack=__bind(this.dislikeTrack,this),this.sortTracks=__bind(this.sortTracks,this),this.sendTrack=__bind(this.sendTrack,this),this.newTrack=__bind(this.newTrack,this),this.bindEvents=__bind(this.bindEvents,this),this.resetVote=__bind(this.resetVote,this),this.resume=__bind(this.resume,this),this.updateList=__bind(this.updateList,this),this.updateTrack=__bind(this.updateTrack,this),this.reconnect=__bind(this.reconnect),this.trackQueue=[],this.dispatcher=new WebSocketRails(t,e),this.dispatcher.on_open=this.createGuestUser,this.bindEvents(),this.ready=__bind(this.ready,this)}return t.prototype.template=function(t){var e;return t=jQuery.parseJSON(t),e="<li class='track' data-id='"+t.id+"' data-key='"+t.key+"' data-order='0'> <div class='track-arrow'> <img src='"+t.image+"' class='trackIcon'> <div class='trackInfo'> <span class='track-title'>"+t.title+"</span><br> <span class='track-artist'>"+t.artist+"</span><br> Vote: <span class='vote'>0</span> </div> </div>","HOST"!==$("#guest").val()&&(e+="<div class='like' id='<%= song.id %>'> <form action='/like' accept-charset='UTF-8' data-remote='true' method='post'> <svg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' width='58.222px' height='62.814px' viewBox='22.259 3.037 58.222 62.814' enable-background='new 22.259 3.037 58.222 62.814' xmlns:xlink='http://www.w3.org/1999/xlink' xml:space='preserve' class='vote_btn like_button'> <g> <g> <path d='M75.814,27.704h-14c-2,0-3.703,1.63-3.703,3.704c0,2.074,1.629,3.704,3.703,3.704h14c2,0,3.704-1.63,3.704-3.704 C79.519,29.333,77.814,27.704,75.814,27.704z'></path> <path d='M59.074,41.63c0,2,1.629,3.704,3.703,3.704h14c2,0,3.704-1.63,3.704-3.704c0-2.074-1.63-3.704-3.704-3.704H62.703 C60.703,38,59.074,39.63,59.074,41.63z'></path> <path d='M56.26,51.926c0,2,1.629,3.704,3.703,3.704h14c2,0,3.703-1.63,3.703-3.704c0-2.074-1.629-3.704-3.703-3.704h-14 C57.963,48.222,56.26,49.926,56.26,51.926z'></path> <path d='M48.111,62.148c0,2,1.629,3.703,3.703,3.703h14c2,0,3.704-1.629,3.704-3.703s-1.63-3.704-3.704-3.704H51.74 C49.741,58.519,48.111,60.148,48.111,62.148z'></path> </g> <path d='M58.26,36.815c-1.926-1.111-3.186-3.111-3.186-5.408c0-1.111,0.297-2.222,0.814-3.111H44.852V9.037c0-3.333-2.667-6-6-6 c-3.333,0-6.074,2.667-6.074,6v27.185c0,0.148,0,0.296,0,0.444c0,0.148,0,0.296,0,0.445v18.074c0,4.889,4,8.889,8.889,8.889h3.63 C45.148,63.481,45,62.889,45,62.223c0-3.482,2.815-6.297,6.297-6.297h3.333c-0.89-1.111-1.481-2.519-1.481-4 c0-2.814,1.926-5.259,4.444-6c-1.037-1.111-1.704-2.592-1.704-4.296C55.963,39.704,56.852,38,58.26,36.815z'></path> <g> <path d='M29.815,56.666V38.593c0-0.148,0-0.296,0-0.445c0-0.148,0-0.296,0-0.444v-7.778h-7.556v35.556h15.407l0,0 C33.222,64.963,29.815,61.186,29.815,56.666z'></path> </g> </g> </svg> <input type='hidden' name='song' id='song' value='"+t.id+"'> <input type='hidden' name='host_id' id='host_id' value='"+this.user.host_id+"'> </form> <form action='/dislike' accept-charset='UTF-8' data-remote='true' method='post'> <svg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' width='58.222px' height='62.814px' viewBox='22.259 3.037 58.222 62.814' enable-background='new 22.259 3.037 58.222 62.814' xmlns:xlink='http://www.w3.org/1999/xlink' xml:space='preserve' class='vote_btn dislike_button'> <g> <g> <path d='M75.814,27.704h-14c-2,0-3.703,1.63-3.703,3.704c0,2.074,1.629,3.704,3.703,3.704h14c2,0,3.704-1.63,3.704-3.704 C79.519,29.333,77.814,27.704,75.814,27.704z'></path> <path d='M59.074,41.63c0,2,1.629,3.704,3.703,3.704h14c2,0,3.704-1.63,3.704-3.704c0-2.074-1.63-3.704-3.704-3.704H62.703 C60.703,38,59.074,39.63,59.074,41.63z'></path> <path d='M56.26,51.926c0,2,1.629,3.704,3.703,3.704h14c2,0,3.703-1.63,3.703-3.704c0-2.074-1.629-3.704-3.703-3.704h-14 C57.963,48.222,56.26,49.926,56.26,51.926z'></path> <path d='M48.111,62.148c0,2,1.629,3.703,3.703,3.703h14c2,0,3.704-1.629,3.704-3.703s-1.63-3.704-3.704-3.704H51.74 C49.741,58.519,48.111,60.148,48.111,62.148z'></path> </g> <path d='M58.26,36.815c-1.926-1.111-3.186-3.111-3.186-5.408c0-1.111,0.297-2.222,0.814-3.111H44.852V9.037c0-3.333-2.667-6-6-6 c-3.333,0-6.074,2.667-6.074,6v27.185c0,0.148,0,0.296,0,0.444c0,0.148,0,0.296,0,0.445v18.074c0,4.889,4,8.889,8.889,8.889h3.63 C45.148,63.481,45,62.889,45,62.223c0-3.482,2.815-6.297,6.297-6.297h3.333c-0.89-1.111-1.481-2.519-1.481-4 c0-2.814,1.926-5.259,4.444-6c-1.037-1.111-1.704-2.592-1.704-4.296C55.963,39.704,56.852,38,58.26,36.815z'></path> <g> <path d='M29.815,56.666V38.593c0-0.148,0-0.296,0-0.445c0-0.148,0-0.296,0-0.444v-7.778h-7.556v35.556h15.407l0,0 C33.222,64.963,29.815,61.186,29.815,56.666z'></path> </g> </g> </svg> <input type='hidden' name='song' id='song' value='"+t.id+"'> <input type='hidden' name='host_id' id='host_id' value='"+this.user.host_id+"'> </form> </div> </li>"),$(e)},t.prototype.userListTemplate=function(t){var e,a,r,i;for(a="",r=0,i=t.length;i>r;r++)e=t[r],a+="<li>"+e.user_name+"</li>";return $(a)},t.prototype.bindEvents=function(){$("#tracks .track").removeClass("playing-track"),$("#tracks .track:eq(0)").addClass("playing-track"),dispatcher=this.dispatcher,$("#tracks").on("click",".like_button",function(){dispatcher.trigger("song_like",{host_id:$(".roomcode").html(),song:$(this).parents(".track:first").data("id")}),$(this).parent().parent().fadeOut("normal"),console.log(Playlist)}),$("#tracks").on("click",".dislike_button",function(){dispatcher.trigger("song_dislike",{host_id:$(".roomcode").html(),song:$(this).parents(".track:first").data("id")}),$(this).parent().parent().fadeOut("normal")})},t.prototype.likeTrack=function(t){$('*[data-id="'+t.song+'"] .vote').html(function(t,e){return+e+1}),console.log(t),this.sortTracks()},t.prototype.dislikeTrack=function(t){$('*[data-id="'+t.song+'"] .vote').html(function(t,e){return e>0?""+e-1:0}),this.sortTracks()},t.prototype.updateList=function(t){order=jQuery.parseJSON(t.order),current_order=$.map($(".track"),function(t){return $(t).data("key")}),this.sortTracks()},t.prototype.sortTracks=function(){tinysort($(".track"),{selector:"span.vote",order:"desc"},{data:"id",order:"desc"}),$("#tracks .track").removeClass("playing-track"),$("#tracks .track:eq(0)").addClass("playing-track")},t.prototype.newTrack=function(t){this.appendTrack(t)},t.prototype.updateTrack=function(t){var e=["#FF1D3E","#FF8A15","#35D8B9","#FFBE1D","#A250CC","#6945CE","#F94EA0","#E24040","#5983D8","#5FDB37","#F76F34"];randColour=e[Math.floor(Math.random()*e.length)],$("#circleText").css("fill",randColour),$("#circleText").text(t)},t.prototype.sendTrack=function(t){var e;return t.preventDefault(),e=$("#search-data").val(),this.dispatcher.trigger("new_track",{user_name:this.user.user_name,track_search:e}),$("#search-data").val("")},t.prototype.resetVote=function(t){console.log(t),$('*[data-id="'+t.song+'"] .vote').html("0"),$('*[data-id="'+t.song+'"] .like').fadeIn(),this.sortTracks()},t.prototype.resume=function(){console.log("wat")},t.prototype.updateUserList=function(t){return $("#user-list").html(this.userListTemplate(t))},t.prototype.appendTrack=function(t){var e;return e=this.template(t),$("#tracks").append(e),e.slideDown(140)},t.prototype.shiftTrackQueue=function(){return this.trackQueue.shift(),$("#tracks li:first").slideDown(100,function(){return $(this).remove()})},t.prototype.createGuestUser=function(){return this.user=new Playlist.User($("#guest").val(),$("#host").val()),channel=this.dispatcher.subscribe("host"+this.user.host_id),channel.bind("user_list",this.updateUserList),channel.bind("connection_closed",this.reconnect),channel.bind("new_track",this.newTrack),channel.bind("like_track",this.likeTrack),channel.bind("dislike_track",this.dislikeTrack),channel.bind("reset_vote",this.resetVote),channel.bind("update_list",this.updateList),channel.bind("resume_play",this.resume),channel.bind("update_track",this.updateTrack),this.dispatcher.trigger("reorder_playlist",{host_id:$(".roomcode").html()}),this.dispatcher.trigger("new_guest",this.user.serialize())},t.prototype.reconnect=function(){console.log("dc"),location.reload()},t.prototype.ready=function(){apiswf=$("#apiswf").get(0),apiswf.rdio_startFrequencyAnalyzer({frequencies:"10-band",period:100}),$(".controls").fadeIn(),apiswf.rdio_setRepeat(2)},t.prototype.playStateChanged=function(t){console.log("state: "+t),trackVotes=[],$("#tracks .track").each(function(t){trackVotes.push(parseInt($("#tracks .track:eq("+t+") .vote").html()))}),allSame=trackVotes.allValuesSame(),3===t&&($(".modular").attr("class","modular stop busy"),track_pos>0&&!allSame&&apiswf.rdio_play($("#play_key").val())),1===t&&$(".modular").attr("class","modular next free"),0===t&&$(".modular").attr("class","modular next free")},t.prototype.playingTrackChanged=function(t,e){console.log("position: "+e),trackVotes=[],$("#tracks .track").each(function(t){trackVotes.push(parseInt($("#tracks .track:eq("+t+") .vote").html()))}),allSame=trackVotes.allValuesSame(),track_pos=e,lastPlayed="",allSame||(e>1?console.log("dud"):1===e?(dispatcher=channel._dispatcher,dispatcher.trigger("reorder_playlist",{host_id:$(".roomcode").html()})):0===e&&lastPlayed!==t.key&&(console.log(lastPlayed+" <- last current -> "+t.key),lastPlayed=t.key,dispatcher.trigger("clear",{key:t.key,host_id:$(".roomcode").html()}),dispatcher.trigger("reorder_playlist",{host_id:$(".roomcode").html()}))),$("#track").text(t.name),truncatedTrack=t.name.substring(0,20),channel.trigger("update_track",truncatedTrack),$("#album").text(t.album),$("#artist").text(t.artist),$("#art").fadeTo(1e3,.3,function(){$("#art").attr("src",t.icon)}).fadeTo(500,1),$("#progress").attr("max",t.duration),$("#switcher").css("padding-bottom",$(".playback-container").css("height")),$(".divider").show(),$(".artistAlbumInfo").css("background-color","#FFF")},t.prototype.positionChanged=function(t){$("#progress").attr("value",t)},t.prototype.updateFrequencyData=function(t){var e=t.split(",");$("#freq div").each(function(t){$(this).height(parseInt(70*parseFloat(e[t])))})},t}();